services:
  # Node.js Backend Service
  - type: web
    name: f1-backend
    runtime: node
    region: oregon
    buildCommand: cd backend && npm install
    startCommand: cd backend && node index.js
    envVars:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: 5000
      - key: MONGODB_URI
        sync: false
      - key: YOUTUBE_API_KEY
        sync: false
      - key: GEMIMI_API_KEY
        sync: false
      - key: NEWS_API_KEY
        sync: false
      - key: JWT_SECRET
        generateValue: true
      - key: PYTHON_API_URL
        value: https://f1-python-api.onrender.com
      - key: FRONTEND_URL
        value: https://f1-frontend.onrender.com

  # Python FastAPI Service
  - type: web
    name: f1-python-api
    runtime: python
    region: oregon
    buildCommand: pip install -r backend/src/python/requirements.txt
    startCommand: cd backend/src/python && uvicorn highlightExtractor:app --host 0.0.0.0 --port $PORT
    envVars:
      - key: PORT
        value: 8000

  # React Frontend (Static Site)
  - type: web
    name: f1-frontend
    runtime: static
    buildCommand: cd f1-explorer && npm install && npm run build
    staticPublishPath: f1-explorer/build
    envVars:
      - key: REACT_APP_API_URL
        value: https://f1-backend.onrender.com
      - key: REACT_APP_AUTH0_DOMAIN
        sync: false
      - key: REACT_APP_AUTH0_CLIENT_ID
        sync: false
      - key: REACT_APP_AUTH0_REDIRECT_URI
        value: https://f1-frontend.onrender.com/callback
